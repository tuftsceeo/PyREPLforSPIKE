{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\gsess\\\\Documents\\\\React\\\\repl\\\\src\\\\components\\\\Serial\\\\Serial.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport SerialButton from \"./SerialButton\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet port = null;\nconst CONTROL_C = '\\x03'; // CTRL-C character \n\nconst CONTROL_D = '\\x04'; // CTRL-D character\n\n/*\r\n    InitWebSerial\r\n    - Initializes a Web Serial Port and returns the initialized port\r\n    - Returns the port if successful, null otherwise\r\n*/\n\nasync function initWebSerial() {\n  port = await navigator.serial.getPorts();\n  port = await navigator.serial.requestPort({// filters:[filter]\n  }); // wait for the port to open.\n\n  try {\n    await port.open({\n      baudRate: 115200\n    });\n  } catch (er) {\n    console.log(\"%cTuftsCEEO \", \"color: #3ba336;\", er); //await port.close();\n  }\n\n  if (port.readable) {\n    return true;\n  } else {\n    return false;\n  }\n} // Reads Data from the SPIKE Prime (Uint8Array Format)\n\n\nasync function readPort() {\n  // eslint-disable-next-line no-undef\n  let decoder = new TextDecoderStream();\n  let inputDone = port.readable.pipeTo(decoder.writable);\n  const inputStream = decoder.readable;\n  const reader = inputStream.getReader();\n\n  while (port.readable) {\n    //const reader = port.readable.getReader();\n    try {\n      while (true) {\n        const {\n          value,\n          done\n        } = await reader.read();\n\n        if (done) {\n          // |reader| has been canceled.\n          break;\n        }\n\n        console.log(value);\n      }\n    } catch (error) {\n      console.error(error);\n    } finally {\n      reader.releaseLock();\n    }\n  }\n} // Writes a string (or array of strings) to the SPIKE terminal\n\n\nasync function writeToPort(lines) {\n  // eslint-disable-next-line no-undef\n  const textEncoder = new TextEncoderStream();\n  const writableStreamClosed = textEncoder.readable.pipeTo(port.writable);\n  const writer = textEncoder.writable.getWriter();\n  if (typeof lines === \"string\") await writer.write(lines);else if (typeof lines === \"object\") {\n    lines.forEach(async element => {\n      console.log(element);\n      await writer.write(element);\n    });\n  } else {\n    console.error(\"Invalid data type: Use Array or String\");\n  } //writer.releaseLock();\n} // Writes and reads code to/from serial port\n\n\nasync function startWebSerial() {\n  if (await initWebSerial()) {\n    //await writeToPort(CONTROL_C)\n    //await writeToPort([CONTROL_C, \"from spike import PrimeHub\", \"hub = Primehub()\", \"hub.light_matrix.show_image('HAPPY')\"])\n    readPort();\n    await writeToPort([CONTROL_C, \"from spike import PrimeHub\", \"hub = Primehub()\", \"hub.light_matrix.show_image('HAPPY')\"]);\n  }\n}\n\nfunction Serial() {\n  _s();\n\n  // Serial Port UI Component Hooks\n  const [connectText, setConnectText] = useState(\"Connect SPIKE Here: \");\n  const [buttonColor, setButtonColor] = useState(\"warning\"); //const [buttonOnclick, setButtonOnclick] = useState(connectToSPIKE);\n  // Changes functionality of serial port button once serial port is connected\n\n  function serialButtonConnected() {\n    setTimeout(() => {\n      setInterval(() => {\n        if (port === null || port == undefined || !port.readable) {\n          setButtonColor(\"error\");\n        } else {\n          setButtonColor(\"success\");\n        }\n      }, 1000);\n    }, 500);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex justify-center\",\n    children: /*#__PURE__*/_jsxDEV(SerialButton, {\n      buttonColor: buttonColor,\n      connectText: connectText,\n      onClick: () => {\n        connectToSPIKE();\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 136,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Serial, \"QQlmSy2wtPF8mPl5lQh1uMdB6ag=\");\n\n_c = Serial;\nexport default Serial;\n\nvar _c;\n\n$RefreshReg$(_c, \"Serial\");","map":{"version":3,"names":["React","useState","SerialButton","port","CONTROL_C","CONTROL_D","initWebSerial","navigator","serial","getPorts","requestPort","open","baudRate","er","console","log","readable","readPort","decoder","TextDecoderStream","inputDone","pipeTo","writable","inputStream","reader","getReader","value","done","read","error","releaseLock","writeToPort","lines","textEncoder","TextEncoderStream","writableStreamClosed","writer","getWriter","write","forEach","element","startWebSerial","Serial","connectText","setConnectText","buttonColor","setButtonColor","serialButtonConnected","setTimeout","setInterval","undefined","connectToSPIKE"],"sources":["C:/Users/gsess/Documents/React/repl/src/components/Serial/Serial.js"],"sourcesContent":["import React, {useState} from \"react\";\r\nimport SerialButton from \"./SerialButton\";\r\n\r\nlet port = null;\r\n\r\nconst CONTROL_C = '\\x03'; // CTRL-C character \r\nconst CONTROL_D = '\\x04'; // CTRL-D character\r\n\r\n/*\r\n    InitWebSerial\r\n    - Initializes a Web Serial Port and returns the initialized port\r\n    - Returns the port if successful, null otherwise\r\n*/\r\nasync function initWebSerial() {\r\n    port = await navigator.serial.getPorts();\r\n\r\n    port = await navigator.serial.requestPort({\r\n        // filters:[filter]\r\n    });\r\n\r\n    // wait for the port to open.\r\n    try {\r\n        await port.open({ baudRate: 115200 });\r\n    }\r\n    catch (er) {\r\n        console.log(\"%cTuftsCEEO \", \"color: #3ba336;\", er);\r\n        //await port.close();\r\n    }\r\n\r\n    if (port.readable) {\r\n        return true;\r\n    }\r\n    else {\r\n        return false;\r\n    }\r\n}\r\n\r\n// Reads Data from the SPIKE Prime (Uint8Array Format)\r\nasync function readPort() {\r\n    // eslint-disable-next-line no-undef\r\n    let decoder = new TextDecoderStream();\r\n    let inputDone = port.readable.pipeTo(decoder.writable);\r\n    const inputStream = decoder.readable;\r\n\r\n    const reader = inputStream.getReader();\r\n    while (port.readable) {\r\n        //const reader = port.readable.getReader();\r\n        try {\r\n            while (true) {\r\n            const { value, done } = await reader.read();\r\n            if (done) {\r\n                // |reader| has been canceled.\r\n                break;\r\n            }\r\n            console.log(value);\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n        } finally {\r\n            reader.releaseLock();\r\n        }\r\n    }\r\n}\r\n\r\n\r\n// Writes a string (or array of strings) to the SPIKE terminal\r\nasync function writeToPort(lines) {\r\n    // eslint-disable-next-line no-undef\r\n    const textEncoder = new TextEncoderStream();\r\n    const writableStreamClosed = textEncoder.readable.pipeTo(port.writable);\r\n\r\n    const writer = textEncoder.writable.getWriter();\r\n\r\n    if (typeof(lines) === \"string\")\r\n        await writer.write(lines);\r\n    else if(typeof(lines) === \"object\") {\r\n        lines.forEach(async (element) => {\r\n            console.log(element)\r\n            await writer.write(element);\r\n        });\r\n    }\r\n    else {\r\n        console.error(\"Invalid data type: Use Array or String\")\r\n    }\r\n    \r\n\r\n    //writer.releaseLock();\r\n    \r\n}\r\n\r\n// Writes and reads code to/from serial port\r\nasync function startWebSerial() {\r\n    if (await initWebSerial()) {\r\n        //await writeToPort(CONTROL_C)\r\n        //await writeToPort([CONTROL_C, \"from spike import PrimeHub\", \"hub = Primehub()\", \"hub.light_matrix.show_image('HAPPY')\"])\r\n        \r\n        readPort()\r\n        await writeToPort([CONTROL_C, \"from spike import PrimeHub\", \"hub = Primehub()\", \"hub.light_matrix.show_image('HAPPY')\"])\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\r\nfunction Serial() {\r\n\r\n    \r\n    // Serial Port UI Component Hooks\r\n    const [connectText, setConnectText] = useState(\"Connect SPIKE Here: \");\r\n    const [buttonColor, setButtonColor] = useState(\"warning\");\r\n    //const [buttonOnclick, setButtonOnclick] = useState(connectToSPIKE);\r\n    \r\n\r\n    // Changes functionality of serial port button once serial port is connected\r\n    function serialButtonConnected() {\r\n        setTimeout(() => {\r\n            setInterval(() => {\r\n                if (port === null || port == undefined ||  !port.readable) {\r\n                    setButtonColor(\"error\");\r\n                }\r\n                else {\r\n                    setButtonColor(\"success\");\r\n                }\r\n            }, 1000);\r\n        }, 500);\r\n        \r\n    }\r\n\r\n    \r\n\r\n  \r\n    \r\n\r\n    return (\r\n        <div className=\"flex justify-center\">\r\n            \r\n            <SerialButton buttonColor={buttonColor} connectText={connectText} onClick={() => {\r\n                connectToSPIKE();\r\n            }} />\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Serial;"],"mappings":"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"},"metadata":{},"sourceType":"module"}