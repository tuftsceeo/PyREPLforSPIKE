{"ast":null,"code":"module.exports = EntryWriter;\n\nvar tar = require(\"../tar.js\"),\n    TarHeader = require(\"./header.js\"),\n    Entry = require(\"./entry.js\"),\n    inherits = require(\"inherits\"),\n    BlockStream = require(\"block-stream\"),\n    ExtendedHeaderWriter,\n    Stream = require(\"stream\").Stream,\n    EOF = {};\n\ninherits(EntryWriter, Stream);\n\nfunction EntryWriter(props) {\n  var me = this;\n\n  if (!(me instanceof EntryWriter)) {\n    return new EntryWriter(props);\n  }\n\n  Stream.apply(this);\n  me.writable = true;\n  me.readable = true;\n  me._stream = new BlockStream(512);\n\n  me._stream.on(\"data\", function (c) {\n    me.emit(\"data\", c);\n  });\n\n  me._stream.on(\"drain\", function () {\n    me.emit(\"drain\");\n  });\n\n  me._stream.on(\"end\", function () {\n    me.emit(\"end\");\n    me.emit(\"close\");\n  });\n\n  me.props = props;\n\n  if (props.type === \"Directory\") {\n    props.size = 0;\n  }\n\n  props.ustar = \"ustar\\0\";\n  props.ustarver = \"00\";\n  me.path = props.path;\n  me._buffer = [];\n  me._didHeader = false;\n  me._meta = false;\n  me.on(\"pipe\", function () {\n    me._process();\n  });\n}\n\nEntryWriter.prototype.write = function (c) {\n  // console.error(\".. ew write\")\n  if (this._ended) return this.emit(\"error\", new Error(\"write after end\"));\n\n  this._buffer.push(c);\n\n  this._process();\n\n  this._needDrain = this._buffer.length > 0;\n  return !this._needDrain;\n};\n\nEntryWriter.prototype.end = function (c) {\n  // console.error(\".. ew end\")\n  if (c) this._buffer.push(c);\n\n  this._buffer.push(EOF);\n\n  this._ended = true;\n\n  this._process();\n\n  this._needDrain = this._buffer.length > 0;\n};\n\nEntryWriter.prototype.pause = function () {\n  // console.error(\".. ew pause\")\n  this._paused = true;\n  this.emit(\"pause\");\n};\n\nEntryWriter.prototype.resume = function () {\n  // console.error(\".. ew resume\")\n  this._paused = false;\n  this.emit(\"resume\");\n\n  this._process();\n};\n\nEntryWriter.prototype.add = function (entry) {\n  // console.error(\".. ew add\")\n  if (!this.parent) return this.emit(\"error\", new Error(\"no parent\")); // make sure that the _header and such is emitted, and clear out\n  // the _currentEntry link on the parent.\n\n  if (!this._ended) this.end();\n  return this.parent.add(entry);\n};\n\nEntryWriter.prototype._header = function () {\n  // console.error(\".. ew header\")\n  if (this._didHeader) return;\n  this._didHeader = true;\n  var headerBlock = TarHeader.encode(this.props);\n\n  if (this.props.needExtended && !this._meta) {\n    var me = this;\n    ExtendedHeaderWriter = ExtendedHeaderWriter || require(\"./extended-header-writer.js\");\n    ExtendedHeaderWriter(this.props).on(\"data\", function (c) {\n      me.emit(\"data\", c);\n    }).on(\"error\", function (er) {\n      me.emit(\"error\", er);\n    }).end();\n  } // console.error(\".. .. ew headerBlock emitting\")\n\n\n  this.emit(\"data\", headerBlock);\n  this.emit(\"header\");\n};\n\nEntryWriter.prototype._process = function () {\n  // console.error(\".. .. ew process\")\n  if (!this._didHeader && !this._meta) {\n    this._header();\n  }\n\n  if (this._paused || this._processing) {\n    // console.error(\".. .. .. paused=%j, processing=%j\", this._paused, this._processing)\n    return;\n  }\n\n  this._processing = true;\n  var buf = this._buffer;\n\n  for (var i = 0; i < buf.length; i++) {\n    // console.error(\".. .. .. i=%d\", i)\n    var c = buf[i];\n    if (c === EOF) this._stream.end();else this._stream.write(c);\n\n    if (this._paused) {\n      // console.error(\".. .. .. paused mid-emission\")\n      this._processing = false;\n\n      if (i < buf.length) {\n        this._needDrain = true;\n        this._buffer = buf.slice(i + 1);\n      }\n\n      return;\n    }\n  } // console.error(\".. .. .. emitted\")\n\n\n  this._buffer.length = 0;\n  this._processing = false; // console.error(\".. .. .. emitting drain\")\n\n  this.emit(\"drain\");\n};\n\nEntryWriter.prototype.destroy = function () {};","map":{"version":3,"names":["module","exports","EntryWriter","tar","require","TarHeader","Entry","inherits","BlockStream","ExtendedHeaderWriter","Stream","EOF","props","me","apply","writable","readable","_stream","on","c","emit","type","size","ustar","ustarver","path","_buffer","_didHeader","_meta","_process","prototype","write","_ended","Error","push","_needDrain","length","end","pause","_paused","resume","add","entry","parent","_header","headerBlock","encode","needExtended","er","_processing","buf","i","slice","destroy"],"sources":["C:/Users/gsess/node_modules/tar/lib/entry-writer.js"],"sourcesContent":["module.exports = EntryWriter\n\nvar tar = require(\"../tar.js\")\n  , TarHeader = require(\"./header.js\")\n  , Entry = require(\"./entry.js\")\n  , inherits = require(\"inherits\")\n  , BlockStream = require(\"block-stream\")\n  , ExtendedHeaderWriter\n  , Stream = require(\"stream\").Stream\n  , EOF = {}\n\ninherits(EntryWriter, Stream)\n\nfunction EntryWriter (props) {\n  var me = this\n\n  if (!(me instanceof EntryWriter)) {\n    return new EntryWriter(props)\n  }\n\n  Stream.apply(this)\n\n  me.writable = true\n  me.readable = true\n\n  me._stream = new BlockStream(512)\n\n  me._stream.on(\"data\", function (c) {\n    me.emit(\"data\", c)\n  })\n\n  me._stream.on(\"drain\", function () {\n    me.emit(\"drain\")\n  })\n\n  me._stream.on(\"end\", function () {\n    me.emit(\"end\")\n    me.emit(\"close\")\n  })\n\n  me.props = props\n  if (props.type === \"Directory\") {\n    props.size = 0\n  }\n  props.ustar = \"ustar\\0\"\n  props.ustarver = \"00\"\n  me.path = props.path\n\n  me._buffer = []\n  me._didHeader = false\n  me._meta = false\n\n  me.on(\"pipe\", function () {\n    me._process()\n  })\n}\n\nEntryWriter.prototype.write = function (c) {\n  // console.error(\".. ew write\")\n  if (this._ended) return this.emit(\"error\", new Error(\"write after end\"))\n  this._buffer.push(c)\n  this._process()\n  this._needDrain = this._buffer.length > 0\n  return !this._needDrain\n}\n\nEntryWriter.prototype.end = function (c) {\n  // console.error(\".. ew end\")\n  if (c) this._buffer.push(c)\n  this._buffer.push(EOF)\n  this._ended = true\n  this._process()\n  this._needDrain = this._buffer.length > 0\n}\n\nEntryWriter.prototype.pause = function () {\n  // console.error(\".. ew pause\")\n  this._paused = true\n  this.emit(\"pause\")\n}\n\nEntryWriter.prototype.resume = function () {\n  // console.error(\".. ew resume\")\n  this._paused = false\n  this.emit(\"resume\")\n  this._process()\n}\n\nEntryWriter.prototype.add = function (entry) {\n  // console.error(\".. ew add\")\n  if (!this.parent) return this.emit(\"error\", new Error(\"no parent\"))\n\n  // make sure that the _header and such is emitted, and clear out\n  // the _currentEntry link on the parent.\n  if (!this._ended) this.end()\n\n  return this.parent.add(entry)\n}\n\nEntryWriter.prototype._header = function () {\n  // console.error(\".. ew header\")\n  if (this._didHeader) return\n  this._didHeader = true\n\n  var headerBlock = TarHeader.encode(this.props)\n\n  if (this.props.needExtended && !this._meta) {\n    var me = this\n\n    ExtendedHeaderWriter = ExtendedHeaderWriter ||\n      require(\"./extended-header-writer.js\")\n\n    ExtendedHeaderWriter(this.props)\n      .on(\"data\", function (c) {\n        me.emit(\"data\", c)\n      })\n      .on(\"error\", function (er) {\n        me.emit(\"error\", er)\n      })\n      .end()\n  }\n\n  // console.error(\".. .. ew headerBlock emitting\")\n  this.emit(\"data\", headerBlock)\n  this.emit(\"header\")\n}\n\nEntryWriter.prototype._process = function () {\n  // console.error(\".. .. ew process\")\n  if (!this._didHeader && !this._meta) {\n    this._header()\n  }\n\n  if (this._paused || this._processing) {\n    // console.error(\".. .. .. paused=%j, processing=%j\", this._paused, this._processing)\n    return\n  }\n\n  this._processing = true\n\n  var buf = this._buffer\n  for (var i = 0; i < buf.length; i ++) {\n    // console.error(\".. .. .. i=%d\", i)\n\n    var c = buf[i]\n\n    if (c === EOF) this._stream.end()\n    else this._stream.write(c)\n\n    if (this._paused) {\n      // console.error(\".. .. .. paused mid-emission\")\n      this._processing = false\n      if (i < buf.length) {\n        this._needDrain = true\n        this._buffer = buf.slice(i + 1)\n      }\n      return\n    }\n  }\n\n  // console.error(\".. .. .. emitted\")\n  this._buffer.length = 0\n  this._processing = false\n\n  // console.error(\".. .. .. emitting drain\")\n  this.emit(\"drain\")\n}\n\nEntryWriter.prototype.destroy = function () {}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}