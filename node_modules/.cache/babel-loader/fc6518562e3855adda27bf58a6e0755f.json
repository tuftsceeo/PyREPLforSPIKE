{"ast":null,"code":"// give it a tarball and a path, and it'll dump the contents\nmodule.exports = Extract;\n\nvar tar = require(\"../tar.js\"),\n    fstream = require(\"fstream\"),\n    inherits = require(\"inherits\"),\n    path = require(\"path\");\n\nfunction Extract(opts) {\n  if (!(this instanceof Extract)) return new Extract(opts);\n  tar.Parse.apply(this);\n\n  if (typeof opts !== \"object\") {\n    opts = {\n      path: opts\n    };\n  } // better to drop in cwd? seems more standard.\n\n\n  opts.path = opts.path || path.resolve(\"node-tar-extract\");\n  opts.type = \"Directory\";\n  opts.Directory = true; // similar to --strip or --strip-components\n\n  opts.strip = +opts.strip;\n  if (!opts.strip || opts.strip <= 0) opts.strip = 0;\n  this._fst = fstream.Writer(opts);\n  this.pause();\n  var me = this; // Hardlinks in tarballs are relative to the root\n  // of the tarball.  So, they need to be resolved against\n  // the target directory in order to be created properly.\n\n  me.on(\"entry\", function (entry) {\n    // if there's a \"strip\" argument, then strip off that many\n    // path components.\n    if (opts.strip) {\n      var p = entry.path.split(\"/\").slice(opts.strip).join(\"/\");\n      entry.path = entry.props.path = p;\n\n      if (entry.linkpath) {\n        var lp = entry.linkpath.split(\"/\").slice(opts.strip).join(\"/\");\n        entry.linkpath = entry.props.linkpath = lp;\n      }\n    }\n\n    if (entry.type === \"Link\") {\n      entry.linkpath = entry.props.linkpath = path.join(opts.path, path.join(\"/\", entry.props.linkpath));\n    }\n\n    if (entry.type === \"SymbolicLink\") {\n      var dn = path.dirname(entry.path) || \"\";\n      var linkpath = entry.props.linkpath;\n      var target = path.resolve(opts.path, dn, linkpath);\n\n      if (target.indexOf(opts.path) !== 0) {\n        linkpath = path.join(opts.path, path.join(\"/\", linkpath));\n      }\n\n      entry.linkpath = entry.props.linkpath = linkpath;\n    }\n  });\n\n  this._fst.on(\"ready\", function () {\n    me.pipe(me._fst, {\n      end: false\n    });\n    me.resume();\n  });\n\n  this._fst.on('error', function (err) {\n    me.emit('error', err);\n  });\n\n  this._fst.on('drain', function () {\n    me.emit('drain');\n  }); // this._fst.on(\"end\", function () {\n  //   console.error(\"\\nEEEE Extract End\", me._fst.path)\n  // })\n\n\n  this._fst.on(\"close\", function () {\n    // console.error(\"\\nEEEE Extract End\", me._fst.path)\n    me.emit(\"finish\");\n    me.emit(\"end\");\n    me.emit(\"close\");\n  });\n}\n\ninherits(Extract, tar.Parse);\n\nExtract.prototype._streamEnd = function () {\n  var me = this;\n  if (!me._ended || me._entry) me.error(\"unexpected eof\");\n\n  me._fst.end(); // my .end() is coming later.\n\n};","map":{"version":3,"names":["module","exports","Extract","tar","require","fstream","inherits","path","opts","Parse","apply","resolve","type","Directory","strip","_fst","Writer","pause","me","on","entry","p","split","slice","join","props","linkpath","lp","dn","dirname","target","indexOf","pipe","end","resume","err","emit","prototype","_streamEnd","_ended","_entry","error"],"sources":["C:/Users/gsess/node_modules/tar/lib/extract.js"],"sourcesContent":["// give it a tarball and a path, and it'll dump the contents\n\nmodule.exports = Extract\n\nvar tar = require(\"../tar.js\")\n  , fstream = require(\"fstream\")\n  , inherits = require(\"inherits\")\n  , path = require(\"path\")\n\nfunction Extract (opts) {\n  if (!(this instanceof Extract)) return new Extract(opts)\n  tar.Parse.apply(this)\n\n  if (typeof opts !== \"object\") {\n    opts = { path: opts }\n  }\n\n  // better to drop in cwd? seems more standard.\n  opts.path = opts.path || path.resolve(\"node-tar-extract\")\n  opts.type = \"Directory\"\n  opts.Directory = true\n\n  // similar to --strip or --strip-components\n  opts.strip = +opts.strip\n  if (!opts.strip || opts.strip <= 0) opts.strip = 0\n\n  this._fst = fstream.Writer(opts)\n\n  this.pause()\n  var me = this\n\n  // Hardlinks in tarballs are relative to the root\n  // of the tarball.  So, they need to be resolved against\n  // the target directory in order to be created properly.\n  me.on(\"entry\", function (entry) {\n    // if there's a \"strip\" argument, then strip off that many\n    // path components.\n    if (opts.strip) {\n      var p = entry.path.split(\"/\").slice(opts.strip).join(\"/\")\n      entry.path = entry.props.path = p\n      if (entry.linkpath) {\n        var lp = entry.linkpath.split(\"/\").slice(opts.strip).join(\"/\")\n        entry.linkpath = entry.props.linkpath = lp\n      }\n    }\n    if (entry.type === \"Link\") {\n      entry.linkpath = entry.props.linkpath =\n        path.join(opts.path, path.join(\"/\", entry.props.linkpath))\n    }\n\n    if (entry.type === \"SymbolicLink\") {\n      var dn = path.dirname(entry.path) || \"\"\n      var linkpath = entry.props.linkpath\n      var target = path.resolve(opts.path, dn, linkpath)\n      if (target.indexOf(opts.path) !== 0) {\n        linkpath = path.join(opts.path, path.join(\"/\", linkpath))\n      }\n      entry.linkpath = entry.props.linkpath = linkpath\n    }\n  })\n\n  this._fst.on(\"ready\", function () {\n    me.pipe(me._fst, { end: false })\n    me.resume()\n  })\n\n  this._fst.on('error', function(err) {\n    me.emit('error', err)\n  })\n\n  this._fst.on('drain', function() {\n    me.emit('drain')\n  })\n\n  // this._fst.on(\"end\", function () {\n  //   console.error(\"\\nEEEE Extract End\", me._fst.path)\n  // })\n\n  this._fst.on(\"close\", function () {\n    // console.error(\"\\nEEEE Extract End\", me._fst.path)\n    me.emit(\"finish\")\n    me.emit(\"end\")\n    me.emit(\"close\")\n  })\n}\n\ninherits(Extract, tar.Parse)\n\nExtract.prototype._streamEnd = function () {\n  var me = this\n  if (!me._ended || me._entry) me.error(\"unexpected eof\")\n  me._fst.end()\n  // my .end() is coming later.\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}